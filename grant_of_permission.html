<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Permission Letter Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .serif {
            font-family: 'Merriweather', serif;
        }
        /* A4 Page size for screen preview */
        .a4-page {
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
            margin: 0 auto;
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            color: #1f2937; /* Gray-800 */
        }

        /* --- PRINT STYLES: HIDES SIDE PANEL AND FORCES LETTER TO FULL WIDTH --- */
        @media print {
            /* 1. Reset all body/html margins and make sure flow is visible */
            html, body {
                background: white !important;
                margin: 0 !important;
                padding: 0 !important;
                height: auto !important;
                overflow: visible !important;
                font-size: 10pt; /* Slightly reduce font size for better single-page fit */
            }

            /* FORCE MAIN LAYOUT CONTAINERS TO STACK AND TAKE FULL WIDTH */
            /* Note: We removed specific class names that collided with no-print here */
            body > div {
                display: block !important;
                height: auto !important;
                width: 100% !important;
                overflow: visible !important;
            }

            /* Reset the preview container to fill the page, removing flex centering */
            .preview-container {
                display: block !important;
                overflow: visible !important;
                height: auto !important;
                padding: 0 !important;
                margin: 0 !important;
                background: white !important;
                width: 100% !important; 
                /* Crucial: Remove centering so letter starts at the left edge */
                justify-content: flex-start !important; 
            }
            
            /* The printable letter page: remove shadow and internal padding */
            .a4-page {
                box-shadow: none !important;
                /* Ensure letter takes up the full width that is available */
                width: 100% !important; 
                margin: 0 auto !important;
                min-height: 0 !important;
                padding: 0 !important; /* @page handles margins */
            }

            /* 2. Reduce margins to ensure letter fits on one page */
            @page {
                size: A4;
                margin: 10mm 15mm; 
            }

            /* HIDE THE ENTIRE CONTROL PANEL - Placed last to override everything else */
            .no-print, .no-print * {
                display: none !important;
                height: 0 !important;
                width: 0 !important;
                opacity: 0 !important;
                visibility: hidden !important;
            }
        }
        /* Custom Scrollbar for form */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<!-- Restored the original split screen layout -->
<body class="h-screen flex flex-col md:flex-row overflow-hidden">

    <!-- Left Side: Control Panel / Form (Visible on screen, Hidden in Print via 'no-print' class) -->
    <div class="w-full md:w-1/3 bg-white border-r border-gray-200 flex flex-col h-full no-print z-10 shadow-lg shrink-0" id="sidePanel">

        <div class="flex-1 overflow-y-auto p-6 space-y-6 custom-scrollbar">
            
            <!-- Requester Details -->
            <div class="space-y-4">
                <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">Requester Details</h3>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Name</label>
                    <input type="text" id="reqName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border" placeholder="John Doe" oninput="updatePreview()">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Institution / Dept</label>
                    <input type="text" id="reqInst" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border" placeholder="University of Calcutta" oninput="updatePreview()">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="reqEmail" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border" placeholder="john@example.com" oninput="updatePreview()">
                </div>
            </div>

            <!-- Request Details -->
            <div class="space-y-4">
                <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">Request Information</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Request Date</label>
                        <input type="date" id="reqDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border" oninput="updatePreview()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Letter Date</label>
                        <input type="date" id="letterDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border" oninput="updatePreview()">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Authorized Purpose</label>
                    <textarea id="purpose" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border" placeholder="Reference material for Comparative Algorithm Study..." oninput="updatePreview()"></textarea>
                </div>
                 <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Valid From</label>
                        <input type="date" id="validFrom" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border" oninput="updatePreview()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Valid Until</label>
                        <input type="text" id="validTo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border" placeholder="May 30, 2026" oninput="updatePreview()">
                    </div>
                </div>
            </div>

             <!-- Your Details (Hidden/Fixed mostly, but editable if needed) -->
            <div class="space-y-4">
                 <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">Author Details</h3>
                 <div>
                    <label class="block text-sm font-medium text-gray-700">Your Name</label>
                    <input type="text" id="authorName" value="Amit Dutta" class="mt-1 block w-full rounded-md border-gray-300 bg-gray-50 shadow-sm sm:text-sm p-2 border" oninput="updatePreview()">
                </div>
            </div>
        </div>

        <div class="p-6 border-t border-gray-200 bg-gray-50 shrink-0">
            <!-- Close Panel button -->
            <button onclick="toggleSidePanel(false)" class="w-full flex justify-center items-center gap-2 bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg shadow transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                Close Side Panel (Press / to open)
            </button>
        </div>
    </div>

    <!-- Right Side: Preview -->
    <div class="flex-1 bg-gray-200 overflow-y-auto p-4 md:p-8 flex justify-center items-start preview-container h-full">
        
        <!-- The Letter Page -->
        <div class="a4-page relative flex flex-col">
            <br><br>
            <!-- Letter Header -->
            <div class="border-b-2 border-slate-800 pb-6 mb-8 flex justify-between items-end">
                <div>
                    <h1 class="text-3xl font-bold text-slate-900 tracking-tight serif uppercase">Formal Grant</h1>
                    <h2 class="text-xl font-light text-slate-600 serif">of Permission</h2>
                </div>
                <div class="text-right">
                    <div class="text-sm font-bold text-slate-800">AMIT DUTTA</div>
                    <div class="text-xs text-slate-500">amitdutta4255@gmail.com</div>
                    <div class="text-xs text-slate-500">github.com/notamitgamer/bsc</div>
                </div>
            </div>

            <!-- Letter Body -->
            <div class="text-sm leading-relaxed space-y-6 serif text-slate-800 flex-1">
                
                <!-- Meta Data (Dynamically populated) -->
                <div class="flex justify-between items-start">
                    <div>
                        <p class="font-bold text-slate-900">To:</p>
                        <p id="prevReqName">[Requester Name]</p>
                        <p id="prevReqInst" class="text-slate-600">[Institution/Department]</p>
                        <p id="prevReqEmail" class="text-slate-600">[Email]</p>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-slate-900">Date:</p>
                        <p id="prevLetterDate">[Date]</p>
                    </div>
                </div>

                <div class="pt-4">
                    <center><p class="font-bold text-slate-900 uppercase underline decoration-2 decoration-slate-300 underline-offset-4">Subject: Authorization for Use of Proprietary Code</p><center>
                </div>

                <p>Dear <span id="prevSalutationName">[Name]</span>,</p>

                <p>
                    I, <strong><span class="prevAuthorName">Amit Dutta</span></strong>, am the copyright holder and author of the software and code assets contained within the GitHub repository <strong class="font-mono text-xs bg-slate-100 px-1 py-0.5 rounded">notamitgamer/bsc</strong> ("The Software").
                </p>

                <p>
                    Based on your request dated <strong id="prevReqDate">[Request Date]</strong>, I hereby grant you a <strong class="text-indigo-900 bg-indigo-50 px-1">limited, non-exclusive, revocable license</strong> to use specific portions of The Software for the purpose described below, notwithstanding the restrictions in the standard <em>Educational Source-Available License (ESAL-1.0)</em>.
                </p>

                <!-- Section 1 -->
                <div class="bg-slate-50 border-l-4 border-slate-800 p-4 my-4">
                    <h3 class="font-bold text-slate-900 text-xs uppercase tracking-wider mb-2">1. Authorized Purpose</h3>
                    <p class="italic text-slate-700" id="prevPurpose">
                        [The specific purpose of use will appear here...]
                    </p>
                </div>

                <!-- Section 2 -->
                <div>
                    <h3 class="font-bold text-slate-900 text-xs uppercase tracking-wider mb-2">2. Terms & Conditions</h3>
                    <p class="mb-2">This permission is subject to the following conditions:</p>
                    <ol class="list-decimal pl-5 space-y-2 marker:font-bold marker:text-slate-400">
                        <li><strong>Attribution:</strong> You must credit the original author (<span class="prevAuthorName">Amit Dutta</span>) in your documentation or source code headers.</li>
                        <li><strong>No Academic Plagiarism:</strong> This permission does <strong>NOT</strong> authorize you to submit this code as your own original work for any graded academic assignment, exam, or coursework. You remain responsible for adhering to your institution's academic integrity policies.</li>
                        <li><strong>Scope:</strong> This permission applies only to the usage described in Section 1. Any other use remains subject to the standard ESAL-1.0 license.</li>
                    </ol>
                </div>

                <!-- Section 3 -->
                <div>
                    <h3 class="font-bold text-slate-900 text-xs uppercase tracking-wider mb-2">3. Validity</h3>
                    <p>
                        This authorization is valid from <strong id="prevValidFrom">[Start Date]</strong> to <strong id="prevValidTo">[End Date]</strong>.
                    </p>
                </div>

                <!-- Sign Off -->
                <div class="pt-8 mt-8 border-t border-slate-200 flex justify-between items-end">
                    <div>
                        <p class="mb-12">Sincerely,</p>
                        <div class="h-16 w-48 border-b border-gray-300"></div> <!-- Space for manual signature -->
                        <p class="font-bold text-slate-900 uppercase text-xs tracking-wider mt-2">Amit Dutta</p>
                        <p class="text-xs text-slate-500">Copyright Holder</p>
                    </div>
                </div>

            </div>
            
            <!-- Footer -->
            <div class="mt-auto pt-8 text-center">
                <div class="border-t border-slate-200 w-full mb-3"></div>
                <p class="text-[0.6rem] text-slate-400 uppercase tracking-widest px-2">
                    This document is a formal waiver of license restrictions for the specified purpose only.
                </p>
            </div>
        </div>
    </div>

    <script>
        const today = new Date().toISOString().split('T')[0];

        // --- Side Panel Toggle Logic ---
        function toggleSidePanel(show = null) {
            const sidePanel = document.getElementById('sidePanel');
            // Toggle the Tailwind 'hidden' class based on the 'show' argument or current state
            const isHidden = sidePanel.classList.contains('hidden');
            
            if (show === true) {
                sidePanel.classList.remove('hidden');
            } else if (show === false) {
                sidePanel.classList.add('hidden');
            } else {
                // Toggle if show is null
                sidePanel.classList.toggle('hidden');
            }
        }

        // --- Keyboard Shortcut Logic: Press '/' to open panel ---
        document.addEventListener('keydown', (e) => {
            // Check if the '/' key is pressed and the panel is currently hidden
            if (e.key === '/' && document.getElementById('sidePanel').classList.contains('hidden')) {
                // Prevent the '/' character from being typed into an input field
                if (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA') {
                    return;
                }
                e.preventDefault(); 
                toggleSidePanel(true); // Explicitly show the panel
            }
        });
        
        // --- Data Population Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            // Restore default values for inputs (if they were present before deletion)
            document.getElementById('letterDate').value = today;
            document.getElementById('reqDate').value = today;
            document.getElementById('validFrom').value = today;
            document.getElementById('reqName').value = "John Doe";
            document.getElementById('reqInst').value = "University of Calcutta";
            document.getElementById('reqEmail').value = "john@example.com";
            document.getElementById('purpose').value = "Reference material for Comparative Algorithm Study for final year project.";
            document.getElementById('validTo').value = "May 30, 2026";
            
            // Initial call to populate the letter
            updatePreview();
        });


        function updatePreview() {
            // Get values from inputs (if they exist, otherwise use placeholders)
            const reqName = document.getElementById('reqName')?.value || "John Doe";
            const reqInst = document.getElementById('reqInst')?.value || "University of Calcutta";
            const reqEmail = document.getElementById('reqEmail')?.value || "john@example.com";
            const reqDate = document.getElementById('reqDate')?.value || today;
            const letterDate = document.getElementById('letterDate')?.value || today;
            const purpose = document.getElementById('purpose')?.value || "Reference material for Comparative Algorithm Study for final year project.";
            const validFrom = document.getElementById('validFrom')?.value || today;
            const validTo = document.getElementById('validTo')?.value || "May 30, 2026";
            const authorName = document.getElementById('authorName')?.value || "Amit Dutta";

            // Update Preview elements
            document.getElementById('prevReqName').innerText = reqName;
            document.getElementById('prevSalutationName').innerText = reqName;
            document.getElementById('prevReqInst').innerText = reqInst;
            document.getElementById('prevReqEmail').innerText = reqEmail;
            document.getElementById('prevReqDate').innerText = formatDate(reqDate);
            document.getElementById('prevLetterDate').innerText = formatDate(letterDate);
            document.getElementById('prevPurpose').innerText = purpose;
            document.getElementById('prevValidFrom').innerText = formatDate(validFrom);
            document.getElementById('prevValidTo').innerText = validTo.includes('-') ? formatDate(validTo) : validTo;
            
            const authorElements = document.getElementsByClassName('prevAuthorName');
            for(let el of authorElements) {
                el.innerText = authorName;
            }
        }

        function formatDate(dateString) {
            if (!dateString || dateString.includes('[')) return dateString;
            // Check if it's a full date string or just a placeholder like "May 30, 2026"
            if (!dateString.includes('-')) return dateString; 

            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            try {
                return new Date(dateString).toLocaleDateString('en-US', options);
            } catch (e) {
                return dateString;
            }
        }
    </script>
</body>
</html>